<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multimedia Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Admin Dashboard Styles */
        .admin-dashboard {
            max-width: 800px;
            margin: 30px auto;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
            display: none;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .admin-content {
            display: none;
        }

        .admin-controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .admin-controls h3 {
            flex-basis: 100%;
            margin-bottom: 10px;
        }

        .admin-button {
            background-color: #16c4e3;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .admin-button:hover {
            background-color: #14b3d1;
        }

        .admin-button.danger {
            background-color: #ff4757;
        }

        .admin-button.danger:hover {
            background-color: #e84118;
        }

        .results-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
        }

        .result-item {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .result-score {
            font-weight: bold;
            color: #16c4e3;
        }

        .result-details {
            display: none;
            background-color: #f5f5f5;
            padding: 8px;
            border-radius: 8px;
            margin-top: 8px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dashed #e0e0e0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .show-details {
            background-color: transparent;
            border: 1px solid #16c4e3;
            color: #16c4e3;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .show-details:hover {
            background-color: rgba(22, 196, 227, 0.1);
        }

        /* Secret admin access button */
        .admin-access {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .admin-access:hover {
            opacity: 1;
        }

        /* Admin password modal */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 16px;
            width: 300px;
            max-width: 90%;
        }

        .modal-title {
            margin-bottom: 16px;
        }

        .password-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 16px;
            font-family: 'Poppins', sans-serif;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f9f9f9;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .quiz-container {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .progress-bar {
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: #16c4e3;
            width: 0%;
            transition: width 0.3s ease;
        }

        .media-container {
            width: 100%;
            margin: 16px 0 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .audio-player {
            width: 100%;
            border-radius: 8px;
        }

        audio {
            width: 100%;
            border-radius: 8px;
        }

        .video-player {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            padding-bottom: 56.25%;
            /* 16:9 Aspect Ratio */
            height: 0;
        }

        .video-player video,
        .video-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            border: none;
        }

        .image-container {
            width: 100%;
            text-align: center;
            margin: 10px 0;
        }

        .quiz-image {
            max-width: 100%;
            border-radius: 8px;
            max-height: 300px;
            object-fit: contain;
        }

        .question {
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question-number {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .option {
            position: relative;
        }

        .option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .option label {
            display: block;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option input[type="radio"]:checked+label {
            border-color: #16c4e3;
            background-color: rgba(22, 196, 227, 0.1);
        }

        .option label:hover {
            border-color: #16c4e3;
        }

        /* New styles for the two-line option format */
        .english-text {
            display: block;
            font-weight: 500;
        }

        .spanish-text {
            display: block;
            font-size: 0.85rem;
            color: #666;
            margin-top: 3px;
            font-style: italic;
        }

        .buttons-container {
            display: flex;
            gap: 12px;
        }

        .button {
            background-color: #16c4e3;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: block;
            flex: 1;
        }

        .button:hover {
            background-color: #14b3d1;
        }

        .button:active {
            transform: scale(0.98);
        }

        .button.prev-btn {
            background-color: #f0f0f0;
            color: #333;
        }

        .button.prev-btn:hover {
            background-color: #e0e0e0;
        }

        .results {
            text-align: center;
            display: none;
        }

        .results h2 {
            margin-bottom: 16px;
            color: #333;
        }

        .score {
            font-size: 3rem;
            font-weight: 600;
            color: #16c4e3;
            margin: 20px 0;
        }

        .result-message {
            margin-bottom: 24px;
            font-size: 1.1rem;
        }

        .quiz-section {
            display: block;
        }

        .fade {
            animation: fadeEffect 0.5s;
        }

        @keyframes fadeEffect {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Confetti for perfect score */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .quiz-container {
                padding: 20px;
            }

            h1 {
                font-size: 1.3rem;
            }

            .score {
                font-size: 2.5rem;
            }

            .buttons-container {
                flex-direction: column;
            }
        }

        /* Added for error messages and audio fallback */
        .error-message {
            background-color: #ffebee;
            border: 1px solid #f44336;
            color: #d32f2f;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.9rem;
        }

        .audio-fallback {
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 10px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <div class="quiz-container">
        <h1>TEST DE PR√ÅCTICA</h1>

        <div class="progress-bar">
            <div class="progress" id="progress-bar"></div>
        </div>

        <div id="quiz-section" class="quiz-section">
            <div class="question-number" id="question-number">Question 1/3</div>

            <div class="media-container" id="media-container">
                <!-- Media elements will be dynamically added here -->
            </div>

            <p id="question" class="question"></p>

            <div id="options" class="options">
                <!-- Options will be dynamically added here -->
            </div>

            <div class="buttons-container">
                <button id="prev-btn" class="button prev-btn">Previous Question</button>
                <button id="next-btn" class="button">Next Question</button>
            </div>
        </div>

        <div id="results-section" class="results">
            <h2>Quiz Complete!</h2>
            <div class="score" id="score">0/0</div>
            <p id="result-message" class="result-message">Thanks for taking the quiz!</p>
            <button id="restart-btn" class="button">Take Quiz Again</button>
        </div>
    </div>

    <div class="confetti-container" id="confetti-container"></div>

    <script>
        // Function to save quiz results to localStorage
        function saveQuizResults(quizId, results) {
            // Create a unique ID for the attempt
            const attemptId = `quiz_${quizId}_${Date.now()}`;

            // Get existing quiz history or create new one
            let quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};

            // Add this attempt
            quizHistory[attemptId] = {
                quizId: quizId,
                date: new Date().toISOString(),
                score: results.score,
                totalQuestions: results.totalQuestions,
                answers: results.answers,
                // Store the original question indices for reference
                questionOrder: results.questionOrder
            };

            // Save back to localStorage
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));

            return attemptId;
        }

        // Function to get quiz history for a specific quiz
        function getQuizHistory(quizId) {
            const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};

            // Filter only attempts for this quiz
            return Object.values(quizHistory).filter(attempt => attempt.quizId === quizId);
        }

        // Function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Quiz data - with support for multiple media types
            const quizData = [
        {
            "question": "What's the meaning of \"Greetings\"?",
            "media": [],
            "options": [
                {
                    "text": "Saludos",
                    "translation": null,
                    "correct": true
                },
                {
                    "text": "Bienvenido",
                    "translation": null,
                    "correct": false
                }
            ]
        },
        {
            "question": "What are they doing?",
            "media": [
                {
                    "type": "image",
                    "src": "https://api-club-file.cb.hotmart.com/public/v5/files/08035877-bcc9-431f-80f9-08e7cbfed096"
                }
            ],
            "options": [
                {
                    "text": "Reading a book",
                    "translation": null,
                    "correct": true
                },
                {
                    "text": "Playing soccer",
                    "translation": null,
                    "correct": false
                }
            ]
        },
        {
            "question": "¬øQu√© hizo la mam√° ayer?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://firebasestorage.googleapis.com/v0/b/chocolearn-f05e5.firebasestorage.app/o/audia%2FDay%201-enhanced-v2-90p.mp3?alt=media&token=f64cf175-2395-410d-9b9e-02904f4df734"
                }
            ],
            "options": [
                {
                    "text": "She cooked their favorite meal",
                    "translation": "Cocin√≥ su comida favorita",
                    "correct": true
                },
                {
                    "text": "She took the family to the park.",
                    "translation": "Llev√≥ a la familia al parque.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¬øQu√© pas√≥ ayer en el trabajo de la hermana?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://firebasestorage.googleapis.com/v0/b/chocolearn-f05e5.firebasestorage.app/o/audia%2FDay%202-enhanced-v2-90p.mp3?alt=media&token=f17d38c2-fd29-4e42-b56c-7e03b42e33ac"
                }
            ],
            "options": [
                {
                    "text": "Someone forgot to pay",
                    "translation": "Alguien olvid√≥ pagar",
                    "correct": true
                },
                {
                    "text": "She spilled the coffee on a customer",
                    "translation": "Derram√≥ el caf√© sobre un cliente",
                    "correct": false
                }
            ]
        },
        {
            "question": "¬øQu√® dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/What%20do%20you%20think%20about%20money.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=g5JKfmA0Gd6qIMpUEBnzLncTkduQxMW%2Bg91TX0o%2BLFJb%2Br%2FSfNBrpAzlHlLBXzyGWzrqlpo0q9LJnmTkmDhDlj1YZ17V9TXomB2KLATWSYr3zy5kOxGPHoKfTCOnob7286mNVy%2F2kaouJ%2BJVb2qKJx%2Fx0WG8B9hkQLE%2FADZZrXrZzcXYWEv7H8WJGKs8FzPaWv2fov7Ij61shdDtNUo7cB1rU5vejBgw%2Bshl1aEfnWp5%2B%2FhKwYHQFdiQhqxTSPbixE6iQ8X3xlHpeTksHjA7UYms09sKLyRpOJT5mh75XiMxpmspV%2BIQsxuIwrNBK9RAnsvna8MjCUGpUQf4izc2%2FQ%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "What do you think about money?",
                    "translation": "¬øQu√© piensas sobre el dinero?",
                    "correct": true
                },
                {
                    "text": "What do you say about money?",
                    "translation": "¬øQu√© dices sobre el dinero?",
                    "correct": false
                }
            ]
        },
        {
            "question": "¬øQu√® dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/What%20will%20you%20do%20tommorrow.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=XRnBlXdcccU6x0prXsNF95sirnLxJ0fXPm1Z%2BghYB8DwAB4Op6rdjHvi5bFBhvVAYK7RY23c62gQKyh291rqgmAChqBVJKg434eYeyPDKafD0RgjwUAjHrtHa4uAbWuX70V6%2FMLLf2yfymJYREO9uzAuFGs9gkNtili%2F%2BmVChuxU%2FpXptiFLFOpBvHQ4nO%2Fln1QE4DcWvyWAIhX97uGAcwinGmwibM89gAvqqIFTIItcI8SnWL83R3lVn4cF1Vxk8YLdwoowkPc3pGA3c3%2Fi1jEmpiFjKHVI9P6vTvVhU3HL2cyHfmG4O1ilWQUchsJ7GiPUJg%2FwZd9XllzYSAPUWQ%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "What will you do tommorrow?",
                    "translation": "¬øQu√© har√°s ma√±ana?",
                    "correct": true
                },
                {
                    "text": "What won't you do tommorrow?",
                    "translation": "¬øQu√© no har√°s ma√±ana?",
                    "correct": false
                }
            ]
        },
        {
            "question": "What role do the babies under a year old have in the factory? üë∂ üè¢",
            "media": [
                {
                    "type": "iframe",
                    "src": "https://drive.google.com/file/d/1_m3OafC03Yx1ddms-pWhI_5ov5GPoCHd/preview",
                    "poster": "/api/placeholder/400/300"
                }
            ],
            "options": [
                {
                    "text": "security guards",
                    "translation": "guardias de seguridad",
                    "correct": true
                },
                {
                    "text": "answering calls",
                    "translation": "contestar llamadas",
                    "correct": false
                }
            ]
        },
        {
            "question": "How many children do Alberto and Rosa hope to have in total? üå± üí≠",
            "media": [
                {
                    "type": "iframe",
                    "src": "https://drive.google.com/file/d/1YRWd8w2Ytouiv29CBepSLOTEY48kXQ8v/preview",
                    "poster": "/api/placeholder/400/300"
                }
            ],
            "options": [
                {
                    "text": "thirty ",
                    "translation": "treinta",
                    "correct": true
                },
                {
                    "text": "twenty-three ",
                    "translation": "veintitr√©s  ",
                    "correct": false
                }
            ]
        },
        {
            "question": "How did Ben respond when people were surprised to see a factory on a boat?  \n¬øC√≥mo respond√≠a Ben cuando la gente se sorprend√≠a de ver una f√°brica en un bote?",
            "media": [
                {
                    "type": "iframe",
                    "src": "https://drive.google.com/file/d/1AenGbvSuAtC_2-KNL7poTzIu7xYb4q6P/preview",
                    "poster": "/api/placeholder/400/300"
                }
            ],
            "options": [
                {
                    "text": "‚ÄúWhen pigs fly, you‚Äôll see a factory that works harder‚Äù",
                    "translation": "‚ÄúCuando los cerdos vuelen, ver√°s una f√°brica que trabaje m√°s duro‚Äù",
                    "correct": true
                },
                {
                    "text": "‚ÄúIt‚Äôs just a normal boat, nothing special‚Äù",
                    "translation": "‚ÄúEs solo un bote normal, nada especial‚Äù",
                    "correct": false
                }
            ]
        },
        {
            "question": "What did Lily do when she heard a strange sound at night?\n¬øQu√© hizo Lily cuando escuch√≥ un sonido extra√±o por la noche?",
            "media": [
                {
                    "type": "iframe",
                    "src": "https://drive.google.com/file/d/1UNae-5nl8vWg38fDAca2WsrXD2nfB_HR/preview",
                    "poster": "/api/placeholder/400/300"
                }
            ],
            "options": [
                {
                    "text": "She went outside to check",
                    "translation": "Fue afuera a revisar",
                    "correct": true
                },
                {
                    "text": "She woke up her parents",
                    "translation": "Despert√≥ a sus padres",
                    "correct": false
                }
            ]
        },

            ];

            // DOM Elements
            const quizSection = document.getElementById('quiz-section');
            const resultsSection = document.getElementById('results-section');
            const progressBar = document.getElementById('progress-bar');
            const questionNumberElement = document.getElementById('question-number');
            const questionElement = document.getElementById('question');
            const optionsContainer = document.getElementById('options');
            const mediaContainer = document.getElementById('media-container');
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');
            const scoreElement = document.getElementById('score');
            const resultMessage = document.getElementById('result-message');
            const restartBtn = document.getElementById('restart-btn');
            const confettiContainer = document.getElementById('confetti-container');

            // Quiz state
            let currentQuestionIndex = 0;
            let score = 0;
            let userAnswers = [];
            let originalQuizData; // Store the original quiz data
            let randomizedQuizData; // Store the randomized quiz data
            let questionOrder; // Keep track of the original question indices

            // Initialize quiz
            function initQuiz() {
                currentQuestionIndex = 0;
                score = 0;

                // Store the original quiz data
                originalQuizData = [...quizData];

                // Randomize question order
                questionOrder = Array.from({
                    length: originalQuizData.length
                }, (_, i) => i);
                questionOrder = shuffleArray(questionOrder);

                // Create randomized quiz data
                randomizedQuizData = questionOrder.map(index => {
                    const question = {
                        ...originalQuizData[index]
                    };

                    // Randomize answer options
                    question.options = shuffleArray(question.options);

                    return question;
                });

                // Initialize user answers array with the new randomized length
                userAnswers = Array(randomizedQuizData.length).fill(null);

                showQuestion(currentQuestionIndex);
                updateProgressBar();
                updateNavigationButtons();

                quizSection.style.display = 'block';
                resultsSection.style.display = 'none';

                // Add quiz ID to store results
                quizSection.dataset.quizId = 'multimedia-quiz-' + Date.now();
            }

            // Show current question
            function showQuestion(index) {
                resetState();

                const currentQuestion = randomizedQuizData[index];
                questionElement.textContent = currentQuestion.question;
                questionNumberElement.textContent = `Question ${index + 1}/${randomizedQuizData.length}`;

                // Add media elements
                if (currentQuestion.media && currentQuestion.media.length > 0) {
                    let mediaLoadError = false;

                    currentQuestion.media.forEach(mediaItem => {
                        if (mediaItem.type === "audio") {
                            const audioDiv = document.createElement('div');
                            audioDiv.className = 'audio-player';

                            const audio = document.createElement('audio');
                            audio.controls = true;

                            const source = document.createElement('source');
                            source.src = mediaItem.src;
                            source.type = "audio/mpeg";

                            // Handle audio loading errors
                            audio.onerror = function() {
                                mediaLoadError = true;
                                audioDiv.innerHTML = `<div class="error-message">
                                    Unable to load audio. Please check your internet connection or try again later.
                                </div>`;

                                // Add transcription if available
                                if (currentQuestion.transcription) {
                                    const fallback = document.createElement('div');
                                    fallback.className = 'audio-fallback';
                                    fallback.textContent = `Audio Transcription: "${currentQuestion.transcription}"`;
                                    audioDiv.appendChild(fallback);
                                }
                            };

                            audio.appendChild(source);
                            audioDiv.appendChild(audio);
                            mediaContainer.appendChild(audioDiv);
                        } else if (mediaItem.type === "image") {
                            const imageDiv = document.createElement('div');
                            imageDiv.className = 'image-container';

                            const image = document.createElement('img');
                            image.src = mediaItem.src;
                            image.alt = mediaItem.alt || "Quiz image";
                            image.className = 'quiz-image';

                            // Handle image loading errors
                            image.onerror = function() {
                                mediaLoadError = true;
                                imageDiv.innerHTML = `<div class="error-message">Unable to load image.</div>`;
                            };

                            imageDiv.appendChild(image);
                            mediaContainer.appendChild(imageDiv);
                        } else if (mediaItem.type === "video") {
                            const videoDiv = document.createElement('div');
                            videoDiv.className = 'video-player';

                            const video = document.createElement('video');
                            video.controls = true;
                            video.poster = mediaItem.poster || "";
                            video.preload = "metadata";

                            const source = document.createElement('source');
                            source.src = mediaItem.src;
                            source.type = "video/mp4";

                            // Handle video loading errors
                            video.onerror = function() {
                                mediaLoadError = true;
                                videoDiv.innerHTML = `<div class="error-message">Unable to load video.</div>`;
                            };

                            video.appendChild(source);
                            videoDiv.appendChild(video);
                            mediaContainer.appendChild(videoDiv);
                        } else if (mediaItem.type === "youtube" || mediaItem.type === "iframe") {
                            const videoDiv = document.createElement('div');
                            videoDiv.className = 'video-player';

                            const iframe = document.createElement('iframe');
                            iframe.src = mediaItem.src;
                            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                            iframe.allowFullscreen = true;

                            // Handle iframe loading errors
                            iframe.onerror = function() {
                                mediaLoadError = true;
                                videoDiv.innerHTML = `<div class="error-message">Unable to load embedded content.</div>`;
                            };

                            videoDiv.appendChild(iframe);
                            mediaContainer.appendChild(videoDiv);
                        }
                    });

                    // Add transcription as fallback if no media
                    if (mediaLoadError && currentQuestion.transcription) {
                        const transcription = document.createElement('div');
                        transcription.className = 'audio-fallback';
                        transcription.textContent = `Transcription: "${currentQuestion.transcription}"`;
                        mediaContainer.appendChild(transcription);
                    }
                } else if (currentQuestion.transcription) {
                    // If question has a transcription but no media
                    const transcription = document.createElement('div');
                    transcription.className = 'audio-fallback';
                    transcription.textContent = `Question: "${currentQuestion.transcription}"`;
                    mediaContainer.appendChild(transcription);
                }

                // Create options with English and Spanish text and restore previous answer if any
                currentQuestion.options.forEach((option, i) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.id = `option${i}`;
                    input.name = 'answer';
                    input.value = i;

                    // Check if user previously selected this option
                    if (userAnswers[currentQuestionIndex] === i) {
                        input.checked = true;
                    }

                    const label = document.createElement('label');
                    label.htmlFor = `option${i}`;

                    // Create spans for English and Spanish text
                    const englishSpan = document.createElement('span');
                    englishSpan.className = 'english-text';
                    englishSpan.textContent = option.text;

                    const spanishSpan = document.createElement('span');
                    spanishSpan.className = 'spanish-text';
                    spanishSpan.textContent = option.translation;

                    label.appendChild(englishSpan);
                    label.appendChild(spanishSpan);

                    optionDiv.appendChild(input);
                    optionDiv.appendChild(label);
                    optionsContainer.appendChild(optionDiv);

                    input.addEventListener('change', () => {
                        userAnswers[currentQuestionIndex] = i;
                    });
                });

                // Update navigation buttons
                updateNavigationButtons();

                // Fade in the new question
                quizSection.classList.add('fade');
                setTimeout(() => {
                    quizSection.classList.remove('fade');
                }, 500);
            }

            // Reset UI state between questions
            function resetState() {
                // Clear options
                while (optionsContainer.firstChild) {
                    optionsContainer.removeChild(optionsContainer.firstChild);
                }

                // Clear media container
                while (mediaContainer.firstChild) {
                    mediaContainer.removeChild(mediaContainer.firstChild);
                }
            }

            // Update navigation button states and text
            function updateNavigationButtons() {
                // Handle previous button visibility
                if (currentQuestionIndex === 0) {
                    prevBtn.style.visibility = 'hidden';
                } else {
                    prevBtn.style.visibility = 'visible';
                }

                // Update next button text for last question
                if (currentQuestionIndex === randomizedQuizData.length - 1) {
                    nextBtn.textContent = 'Finish Quiz';
                } else {
                    nextBtn.textContent = 'Next Question';
                }
            }

            // Handle next question button click
            function handleNextQuestion() {
                // Check if user has selected an answer
                if (userAnswers[currentQuestionIndex] === null) {
                    alert('Please select an answer before proceeding');
                    return;
                }

                // Move to next question or show results
                currentQuestionIndex++;
                updateProgressBar();

                if (currentQuestionIndex < randomizedQuizData.length) {
                    showQuestion(currentQuestionIndex);
                } else {
                    calculateScore();
                    showResults();
                }
            }

            // Handle previous question button click
            function handlePreviousQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    updateProgressBar();
                    showQuestion(currentQuestionIndex);
                }
            }

            // Calculate final score
            function calculateScore() {
                score = 0;
                const detailedAnswers = [];

                for (let i = 0; i < randomizedQuizData.length; i++) {
                    const selectedOptionIndex = userAnswers[i];
                    const isCorrect = selectedOptionIndex !== null &&
                        randomizedQuizData[i].options[selectedOptionIndex].correct;

                    if (isCorrect) {
                        score++;
                    }

                    // Store detailed answer data
                    detailedAnswers.push({
                        questionIndex: questionOrder[i], // Original question index
                        selectedOption: selectedOptionIndex,
                        isCorrect: isCorrect,
                        selectedText: selectedOptionIndex !== null ?
                            randomizedQuizData[i].options[selectedOptionIndex].text : null
                    });
                }

                // Save results to localStorage
                const quizId = quizSection.dataset.quizId;
                saveQuizResults(quizId, {
                    score: score,
                    totalQuestions: randomizedQuizData.length,
                    answers: detailedAnswers,
                    questionOrder: questionOrder
                });

                return score;
            }

            // Show final results
            function showResults() {
                quizSection.style.display = 'none';
                resultsSection.style.display = 'block';

                scoreElement.textContent = `${score}/${randomizedQuizData.length}`;

                const percentage = (score / randomizedQuizData.length) * 100;

                if (percentage === 100) {
                    resultMessage.textContent = 'Perfect score! Amazing job!';
                    createConfetti();
                } else if (percentage >= 75) {
                    resultMessage.textContent = 'Great job! Very impressive!';
                } else if (percentage >= 50) {
                    resultMessage.textContent = 'Good effort!';
                } else {
                    resultMessage.textContent = 'Thanks for taking the quiz!';
                }

                // Clear any existing history section
                const existingHistory = document.querySelector('.history-section');
                if (existingHistory) {
                    existingHistory.remove();
                }

                showQuizHistory();
            }

            // Update progress bar
            function updateProgressBar() {
                const progress = ((currentQuestionIndex) / randomizedQuizData.length) * 100;
                progressBar.style.width = `${progress}%`;
            }

            // Create confetti effect for perfect score
            function createConfetti() {
                const colors = ['#16c4e3', '#fe4980', '#4BB543', '#FFD700', '#9370DB'];
                const confettiCount = 150;

                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = -10 + 'px';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.opacity = Math.random();
                    confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';

                    confettiContainer.appendChild(confetti);

                    const animation = confetti.animate([{
                            transform: 'translate3d(0,0,0) rotate(0deg)',
                            opacity: 1
                        },
                        {
                            transform: 'translate3d(' + (Math.random() * 100 - 50) + 'px,' +
                                (Math.random() * 700 + 500) + 'px,0) rotate(' + Math.random() * 360 + 'deg)',
                            opacity: 0
                        }
                    ], {
                        duration: Math.random() * 2000 + 3000,
                        easing: 'cubic-bezier(' + Math.random() + ',' + Math.random() + ',' + Math.random() + ',' + Math.random() + ')',
                        fill: 'forwards'
                    });

                    animation.onfinish = function() {
                        confetti.remove();
                    };
                }
            }

            // Show quiz history
            function showQuizHistory() {
                const quizId = quizSection.dataset.quizId;
                const history = getQuizHistory(quizId);

                if (history.length === 0) {
                    return; // No history yet
                }

                // Create a history section in results
                const historySection = document.createElement('div');
                historySection.className = 'history-section';
                historySection.innerHTML = `
                    <h3>Previous Attempts</h3>
                    <div class="history-list"></div>
                `;

                const historyList = historySection.querySelector('.history-list');

                // Display last 5 attempts
                history.slice(-5).forEach((attempt, i) => {
                    const date = new Date(attempt.date);
                    const formattedDate = date.toLocaleString();

                    const attemptElement = document.createElement('div');
                    attemptElement.className = 'history-item';
                    attemptElement.innerHTML = `
                        <p>Attempt ${history.length - i}: ${attempt.score}/${attempt.totalQuestions} 
                        (${Math.round((attempt.score / attempt.totalQuestions) * 100)}%) - ${formattedDate}</p>
                    `;

                    historyList.appendChild(attemptElement);
                });

                // Add history section to results
                resultsSection.appendChild(historySection);
            }

            // Restart quiz
            function restartQuiz() {
                // Clear existing confetti if any
                while (confettiContainer.firstChild) {
                    confettiContainer.removeChild(confettiContainer.firstChild);
                }

                // Clear history section if it exists
                const existingHistory = document.querySelector('.history-section');
                if (existingHistory) {
                    existingHistory.remove();
                }

                initQuiz();
            }

            // Add event listeners
            nextBtn.addEventListener('click', handleNextQuestion);
            prevBtn.addEventListener('click', handlePreviousQuestion);
            restartBtn.addEventListener('click', restartQuiz);

            // Start the quiz
            initQuiz();
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Create the name input modal
            const nameModal = document.createElement('div');
            nameModal.className = 'admin-modal';
            nameModal.id = 'name-modal';
            nameModal.innerHTML = `
        <div class="modal-content">
            <h3 class="modal-title">Enter Your Name</h3>
            <input type="text" id="student-name-input" class="password-input" placeholder="Your name">
            <div class="modal-buttons">
                <button id="save-name-btn" class="admin-button">Save</button>
            </div>
        </div>
    `;
            document.body.appendChild(nameModal);

            // Create the change name button that will appear in the quiz container
            const quizContainer = document.querySelector('.quiz-container');
            const nameDisplay = document.createElement('div');
            nameDisplay.className = 'name-display';
            nameDisplay.innerHTML = `
        <div class="student-name-container">
            <span id="displayed-name"></span>
            <button id="change-name-btn" class="name-change-btn">Change Name</button>
        </div>
    `;

            // Insert the name display right after the h1 element
            const quizTitle = quizContainer.querySelector('h1');
            quizTitle.after(nameDisplay);

            // Add needed styling to the head
            const styleElement = document.createElement('style');
            styleElement.textContent = `
        .student-name-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        #displayed-name {
            font-weight: 500;
            color: #16c4e3;
        }
        
        .name-change-btn {
            background-color: transparent;
            border: 1px solid #16c4e3;
            color: #16c4e3;
            border-radius: 8px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .name-change-btn:hover {
            background-color: rgba(22, 196, 227, 0.1);
        }
    `;
            document.head.appendChild(styleElement);

            // Get DOM elements
            const nameInput = document.getElementById('student-name-input');
            const saveNameBtn = document.getElementById('save-name-btn');
            const changeNameBtn = document.getElementById('change-name-btn');
            const displayedName = document.getElementById('displayed-name');

            // Function to save the student name
            function saveStudentName(name) {
                if (name && name.trim() !== '') {
                    localStorage.setItem('studentName', name.trim());
                    displayedName.textContent = name.trim();
                    nameModal.style.display = 'none';
                } else {
                    alert('Please enter a valid name');
                }
            }

            // Check if student name already exists
            function checkStudentName() {
                const storedName = localStorage.getItem('studentName');
                if (storedName) {
                    displayedName.textContent = storedName;
                    return true;
                }
                return false;
            }

            // Event listener for save name button
            saveNameBtn.addEventListener('click', function() {
                saveStudentName(nameInput.value);
            });

            // Enter key handler for name input
            nameInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    saveNameBtn.click();
                }
            });

            // Event listener for change name button
            changeNameBtn.addEventListener('click', function() {
                nameInput.value = localStorage.getItem('studentName') || '';
                nameModal.style.display = 'flex';
                nameInput.focus();
            });

            // Show the name modal if no name is set yet
            if (!checkStudentName()) {
                nameModal.style.display = 'flex';
                nameInput.focus();
            }

            // Modify the saveQuizResults function to include student name
            const originalSaveQuizResults = window.saveQuizResults;
            window.saveQuizResults = function(quizId, results) {
                // Get student name from localStorage
                const studentName = localStorage.getItem('studentName') || 'Anonymous';

                // Add student name to results
                results.studentName = studentName;

                // Call the original function
                return originalSaveQuizResults(quizId, results);
            };

            // Modify the admin dashboard results display to show student names
            const originalLoadAdminResults = window.loadAdminResults;
            if (typeof originalLoadAdminResults === 'function') {
                window.loadAdminResults = function() {
                    const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                    const results = Object.values(quizHistory);

                    if (results.length === 0) {
                        document.getElementById('results-list').innerHTML = '<p>No results yet.</p>';
                        return;
                    }

                    const resultsList = document.getElementById('results-list');
                    resultsList.innerHTML = '';

                    // Sort results by date (newest first)
                    results.sort((a, b) => new Date(b.date) - new Date(a.date));

                    results.forEach((result, index) => {
                        const date = new Date(result.date);
                        const formattedDate = date.toLocaleString();
                        const percentage = Math.round((result.score / result.totalQuestions) * 100);
                        const studentName = result.studentName || `Student ${index + 1}`;

                        const resultItem = document.createElement('div');
                        resultItem.className = 'result-item';

                        // Create header with basic info and student name
                        const resultHeader = document.createElement('div');
                        resultHeader.className = 'result-header';
                        resultHeader.innerHTML = `
                    <div>
                        <strong>${studentName}</strong> - ${formattedDate}
                    </div>
                    <div class="result-score">${result.score}/${result.totalQuestions} (${percentage}%)</div>
                `;

                        // The rest of the original function remains the same
                        // Create details toggle button
                        const detailsBtn = document.createElement('button');
                        detailsBtn.className = 'show-details';
                        detailsBtn.textContent = 'Show Details';

                        // Create details section
                        const detailsSection = document.createElement('div');
                        detailsSection.className = 'result-details';

                        // Add details for each question
                        result.answers.forEach((answer, i) => {
                            // This part would remain the same as your original function
                            // ...
                        });

                        // Toggle details visibility
                        detailsBtn.addEventListener('click', function() {
                            if (detailsSection.style.display === 'none' || detailsSection.style.display === '') {
                                detailsSection.style.display = 'block';
                                detailsBtn.textContent = 'Hide Details';
                            } else {
                                detailsSection.style.display = 'none';
                                detailsBtn.textContent = 'Show Details';
                            }
                        });

                        // Add all elements to the result item
                        resultItem.appendChild(resultHeader);
                        resultItem.appendChild(detailsBtn);
                        resultItem.appendChild(detailsSection);
                        resultsList.appendChild(resultItem);
                    });
                };
            }

            // Modify the CSV export function to include student names
            const originalExportResultsAsCSV = window.exportResultsAsCSV;
            if (typeof originalExportResultsAsCSV === 'function') {
                window.exportResultsAsCSV = function() {
                    const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                    const results = Object.values(quizHistory);

                    if (results.length === 0) {
                        alert('No results to export');
                        return;
                    }

                    let csvContent = 'data:text/csv;charset=utf-8,';

                    // Add CSV header row with student name
                    csvContent += 'Student Name,Date,Score,Total Questions,Percentage\n';

                    // Add a row for each result
                    results.forEach((result) => {
                        const date = new Date(result.date).toLocaleString();
                        const percentage = Math.round((result.score / result.totalQuestions) * 100);
                        const studentName = result.studentName || 'Anonymous';

                        const row = [
                            studentName,
                            date,
                            result.score,
                            result.totalQuestions,
                            `${percentage}%`
                        ];

                        csvContent += row.join(',') + '\n';
                    });

                    // Create download link
                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement('a');
                    link.setAttribute('href', encodedUri);
                    link.setAttribute('download', 'quiz_results.csv');
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };
            }
        });
        // Admin functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add admin access button to the body
            const adminAccessBtn = document.createElement('div');
            adminAccessBtn.className = 'admin-access';
            adminAccessBtn.innerHTML = '‚öôÔ∏è';
            document.body.appendChild(adminAccessBtn);

            // Create admin password modal
            const adminModal = document.createElement('div');
            adminModal.className = 'admin-modal';
            adminModal.innerHTML = `
        <div class="modal-content">
            <h3 class="modal-title">Admin Access</h3>
            <input type="password" id="admin-password" class="password-input" placeholder="Enter admin password">
            <div class="modal-buttons">
                <button id="cancel-admin" class="admin-button danger">Cancel</button>
                <button id="access-admin" class="admin-button">Access</button>
            </div>
        </div>
    `;
            document.body.appendChild(adminModal);

            // Admin dashboard elements
            const adminDashboard = document.getElementById('admin-dashboard');
            const adminContent = document.getElementById('admin-content');
            const toggleAdminBtn = document.getElementById('toggle-admin');
            const exportResultsBtn = document.getElementById('export-results');
            const clearResultsBtn = document.getElementById('clear-results');
            const resultsList = document.getElementById('results-list');

            // Admin password modal elements
            const adminPasswordInput = document.getElementById('admin-password');
            const accessAdminBtn = document.getElementById('access-admin');
            const cancelAdminBtn = document.getElementById('cancel-admin');

            // Admin password - change this to your desired password
            const ADMIN_PASSWORD = 'admin123';

            // Click handler for admin access button
            adminAccessBtn.addEventListener('click', function() {
                adminModal.style.display = 'flex';
                adminPasswordInput.focus();
            });

            // Enter key handler for password input
            adminPasswordInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    accessAdminBtn.click();
                }
            });

            // Access button handler
            accessAdminBtn.addEventListener('click', function() {
                if (adminPasswordInput.value === ADMIN_PASSWORD) {
                    adminModal.style.display = 'none';
                    adminPasswordInput.value = '';
                    adminDashboard.style.display = 'block';
                    loadAdminResults();
                } else {
                    alert('Incorrect password');
                }
            });

            // Cancel button handler
            cancelAdminBtn.addEventListener('click', function() {
                adminModal.style.display = 'none';
                adminPasswordInput.value = '';
            });

            // Toggle admin content
            toggleAdminBtn.addEventListener('click', function() {
                if (adminContent.style.display === 'none' || adminContent.style.display === '') {
                    adminContent.style.display = 'block';
                    loadAdminResults();
                } else {
                    adminContent.style.display = 'none';
                }
            });

            // Export results as CSV
            exportResultsBtn.addEventListener('click', function() {
                exportResultsAsCSV();
            });

            // Clear all results
            clearResultsBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to delete ALL quiz results? This cannot be undone.')) {
                    localStorage.removeItem('quizHistory');
                    loadAdminResults();
                }
            });

            // Load and display quiz results
            function loadAdminResults() {
                const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                const results = Object.values(quizHistory);

                if (results.length === 0) {
                    resultsList.innerHTML = '<p>No results yet.</p>';
                    return;
                }

                resultsList.innerHTML = '';

                // Sort results by date (newest first)
                results.sort((a, b) => new Date(b.date) - new Date(a.date));

                results.forEach((result, index) => {
                    const date = new Date(result.date);
                    const formattedDate = date.toLocaleString();
                    const percentage = Math.round((result.score / result.totalQuestions) * 100);

                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';

                    // Create header with basic info
                    const resultHeader = document.createElement('div');
                    resultHeader.className = 'result-header';
                    resultHeader.innerHTML = `
                <div>
                    <strong>Student ${index + 1}</strong> - ${formattedDate}
                </div>
                <div class="result-score">${result.score}/${result.totalQuestions} (${percentage}%)</div>
            `;

                    // Create details toggle button
                    const detailsBtn = document.createElement('button');
                    detailsBtn.className = 'show-details';
                    detailsBtn.textContent = 'Show Details';

                    // Create details section
                    const detailsSection = document.createElement('div');
                    detailsSection.className = 'result-details';

                    // Add details for each question
                    result.answers.forEach((answer, i) => {
                        const detailRow = document.createElement('div');
                        detailRow.className = 'detail-row';

                        // Get original question data
                        const originalQuestionIndex = result.questionOrder[i];
                        const originalQuestion = quizData[originalQuestionIndex];

                        // Get selected answer text or "No answer"
                        const selectedText = answer.selectedText || "No answer";

                        // Create details content
                        detailRow.innerHTML = `
                    <div>Question ${i + 1}</div>
                    <div>${answer.isCorrect ? '‚úÖ Correct' : '‚ùå Incorrect'}</div>
                    <div>Answer: ${selectedText}</div>
                `;

                        detailsSection.appendChild(detailRow);
                    });

                    // Toggle details visibility
                    detailsBtn.addEventListener('click', function() {
                        if (detailsSection.style.display === 'none' || detailsSection.style.display === '') {
                            detailsSection.style.display = 'block';
                            detailsBtn.textContent = 'Hide Details';
                        } else {
                            detailsSection.style.display = 'none';
                            detailsBtn.textContent = 'Show Details';
                        }
                    });

                    // Add all elements to the result item
                    resultItem.appendChild(resultHeader);
                    resultItem.appendChild(detailsBtn);
                    resultItem.appendChild(detailsSection);
                    resultsList.appendChild(resultItem);
                });
            }

            // Export quiz results as CSV
            function exportResultsAsCSV() {
                const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                const results = Object.values(quizHistory);

                if (results.length === 0) {
                    alert('No results to export');
                    return;
                }

                let csvContent = 'data:text/csv;charset=utf-8,';

                // Add CSV header row
                csvContent += 'Student ID,Date,Score,Total Questions,Percentage\n';

                // Add a row for each result
                results.forEach((result, index) => {
                    const date = new Date(result.date).toLocaleString();
                    const percentage = Math.round((result.score / result.totalQuestions) * 100);

                    const row = [
                        `Student ${index + 1}`,
                        date,
                        result.score,
                        result.totalQuestions,
                        `${percentage}%`
                    ];

                    csvContent += row.join(',') + '\n';
                });

                // Create download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement('a');
                link.setAttribute('href', encodedUri);
                link.setAttribute('download', 'quiz_results.csv');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });

// Modified saveQuizResults function to send data to Google Sheets
function saveQuizResults(quizId, results) {
    // Get student name from localStorage
    const studentName = localStorage.getItem('studentName') || 'Anonymous';
    
    // Add student name to results
    results.studentName = studentName;
    
    // Create a unique ID for the attempt
    const attemptId = `quiz_${quizId}_${Date.now()}`;
    
    // Get existing quiz history or create new one
    let quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
    
    // Add this attempt to local storage
    quizHistory[attemptId] = {
        quizId: quizId,
        date: new Date().toISOString(),
        score: results.score,
        totalQuestions: results.totalQuestions,
        studentName: studentName,
        answers: results.answers,
        questionOrder: results.questionOrder
    };
    
    // Save back to localStorage
    localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
    
    // Send to Google Sheets
    sendResultsToGoogleSheets({
        quizId: quizId,
        studentName: studentName,
        score: results.score,
        totalQuestions: results.totalQuestions,
        answers: results.answers
    });
    
    return attemptId;
}

// Function to send results to Google Sheets
function sendResultsToGoogleSheets(data) {
    // Replace with your Google Apps Script Web App URL 
    const googleScriptUrl = 'https://script.google.com/macros/s/AKfycbzkjpXhL-cL0yln8epsUAH_bl__3ag7O3O1-i51ITUHp2JLB9IyHjQ8aMPfwQi4JnrBTA/exec';
    
    // Create status message element if it doesn't exist
    let statusMessageElement = document.getElementById('sheets-status-message');
    if (!statusMessageElement) {
        statusMessageElement = document.createElement('div');
        statusMessageElement.id = 'sheets-status-message';
        statusMessageElement.style.padding = '10px';
        statusMessageElement.style.marginTop = '10px';
        statusMessageElement.style.borderRadius = '8px';
        statusMessageElement.style.textAlign = 'center';
        statusMessageElement.style.fontWeight = '500';
        const resultsSection = document.getElementById('results-section');
        resultsSection.appendChild(statusMessageElement);
    }
    
    // Show "Saving..." message
    statusMessageElement.textContent = 'Saving results to Google Sheets...';
    statusMessageElement.style.backgroundColor = '#e3f2fd';
    statusMessageElement.style.color = '#0277bd';
    statusMessageElement.style.border = '1px solid #0277bd';
    
    // Send data to Google Sheets
    fetch(googleScriptUrl, {
        method: 'POST',
        body: JSON.stringify(data),
        headers: {
            'Content-Type': 'application/json'
        },
        mode: 'no-cors' // Required for Google Apps Script
    })
    .then(() => {
        // We can't get the actual response due to CORS, so just assume success
        statusMessageElement.textContent = 'Results saved successfully!';
        statusMessageElement.style.backgroundColor = '#e8f5e9';
        statusMessageElement.style.color = '#2e7d32';
        statusMessageElement.style.border = '1px solid #2e7d32';
        
        // Hide the message after 5 seconds
        setTimeout(() => {
            statusMessageElement.style.display = 'none';
        }, 5000);
    })
    .catch(error => {
        console.error('Error saving to Google Sheets:', error);
        statusMessageElement.textContent = 'Error saving results. Please try again later.';
        statusMessageElement.style.backgroundColor = '#ffebee';
        statusMessageElement.style.color = '#c62828';
        statusMessageElement.style.border = '1px solid #c62828';
    });
}
        
    </script>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="admin-dashboard">
        <div class="admin-header">
            <h2>Admin Dashboard</h2>
            <button id="toggle-admin" class="admin-button">Toggle Admin Panel</button>
        </div>
        <div id="admin-content" class="admin-content">
            <div class="admin-controls">
                <h3>Student Results</h3>
                <button id="export-results" class="admin-button">Export All Results (CSV)</button>
                <button id="clear-results" class="admin-button danger">Clear All Results</button>
            </div>
            <div id="results-list" class="results-list">
                <p>No results yet.</p>
            </div>
        </div>
    </div>

</body>

</html>
