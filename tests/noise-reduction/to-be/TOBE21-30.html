<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TO BE - PART 3</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Admin Dashboard Styles */
        .admin-dashboard {
            max-width: 800px;
            margin: 30px auto;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
            display: none;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .admin-content {
            display: none;
        }

        .admin-controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
        }

        .admin-controls h3 {
            flex-basis: 100%;
            margin-bottom: 10px;
        }

        .admin-button {
            background-color: #16c4e3;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .admin-button:hover {
            background-color: #14b3d1;
        }

        .admin-button.danger {
            background-color: #ff4757;
        }

        .admin-button.danger:hover {
            background-color: #e84118;
        }

        .results-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
        }

        .result-item {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .result-score {
            font-weight: bold;
            color: #16c4e3;
        }

        .result-details {
            display: none;
            background-color: #f5f5f5;
            padding: 8px;
            border-radius: 8px;
            margin-top: 8px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dashed #e0e0e0;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .show-details {
            background-color: transparent;
            border: 1px solid #16c4e3;
            color: #16c4e3;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .show-details:hover {
            background-color: rgba(22, 196, 227, 0.1);
        }

        /* Secret admin access button */
        .admin-access {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .admin-access:hover {
            opacity: 1;
        }

        /* Admin password modal */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 24px;
            border-radius: 16px;
            width: 300px;
            max-width: 90%;
        }

        .modal-title {
            margin-bottom: 16px;
        }

        .password-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 16px;
            font-family: 'Poppins', sans-serif;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f9f9f9;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .quiz-container {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 24px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .progress-bar {
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: #16c4e3;
            width: 0%;
            transition: width 0.3s ease;
        }

        .media-container {
            width: 100%;
            margin: 16px 0 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .audio-player {
            width: 100%;
            border-radius: 8px;
        }

        audio {
            width: 100%;
            border-radius: 8px;
        }

        .video-player {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            padding-bottom: 56.25%;
            /* 16:9 Aspect Ratio */
            height: 0;
        }

        .video-player video,
        .video-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            border: none;
        }

        .image-container {
            width: 100%;
            text-align: center;
            margin: 10px 0;
        }

        .quiz-image {
            max-width: 100%;
            border-radius: 8px;
            max-height: 300px;
            object-fit: contain;
        }

        .question {
            margin-bottom: 20px;
            font-weight: 500;
        }

        .question-number {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        }

        .option {
            position: relative;
        }

        .option input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .option label {
            display: block;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option input[type="radio"]:checked+label {
            border-color: #16c4e3;
            background-color: rgba(22, 196, 227, 0.1);
        }

        .option label:hover {
            border-color: #16c4e3;
        }

        /* New styles for the two-line option format */
        .english-text {
            display: block;
            font-weight: 500;
        }

        .spanish-text {
            display: block;
            font-size: 0.85rem;
            color: #666;
            margin-top: 3px;
            font-style: italic;
        }

        .buttons-container {
            display: flex;
            gap: 12px;
        }

        .button {
            background-color: #16c4e3;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: block;
            flex: 1;
        }

        .button:hover {
            background-color: #14b3d1;
        }

        .button:active {
            transform: scale(0.98);
        }

        .button.prev-btn {
            background-color: #f0f0f0;
            color: #333;
        }

        .button.prev-btn:hover {
            background-color: #e0e0e0;
        }

        .results {
            text-align: center;
            display: none;
        }

        .results h2 {
            margin-bottom: 16px;
            color: #333;
        }

        .score {
            font-size: 3rem;
            font-weight: 600;
            color: #16c4e3;
            margin: 20px 0;
        }

        .result-message {
            margin-bottom: 24px;
            font-size: 1.1rem;
        }

        .quiz-section {
            display: block;
        }

        .fade {
            animation: fadeEffect 0.5s;
        }

        @keyframes fadeEffect {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Confetti for perfect score */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .quiz-container {
                padding: 20px;
            }

            h1 {
                font-size: 1.3rem;
            }

            .score {
                font-size: 2.5rem;
            }

            .buttons-container {
                flex-direction: column;
            }
        }

        /* Added for error messages and audio fallback */
        .error-message {
            background-color: #ffebee;
            border: 1px solid #f44336;
            color: #d32f2f;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.9rem;
        }

        .audio-fallback {
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 10px;
            border-radius: 8px;
            margin-top: 8px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <div class="quiz-container">
        <h1>TO BE - PART 3</h1>

        <div class="progress-bar">
            <div class="progress" id="progress-bar"></div>
        </div>

        <div id="quiz-section" class="quiz-section">
            <div class="question-number" id="question-number">Question 1/3</div>

            <div class="media-container" id="media-container">
                <!-- Media elements will be dynamically added here -->
            </div>

            <p id="question" class="question"></p>

            <div id="options" class="options">
                <!-- Options will be dynamically added here -->
            </div>

            <div class="buttons-container">
                <button id="prev-btn" class="button prev-btn">Previous Question</button>
                <button id="next-btn" class="button">Next Question</button>
            </div>
        </div>

        <div id="results-section" class="results">
            <h2>Quiz Complete!</h2>
            <div class="score" id="score">0/0</div>
            <p id="result-message" class="result-message">Thanks for taking the quiz!</p>
            <button id="restart-btn" class="button">Take Quiz Again</button>
        </div>
    </div>

    <div class="confetti-container" id="confetti-container"></div>

    <script>
        // Function to save quiz results to localStorage
        function saveQuizResults(quizId, results) {
            // Create a unique ID for the attempt
            const attemptId = `quiz_${quizId}_${Date.now()}`;

            // Get existing quiz history or create new one
            let quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};

            // Add this attempt
            quizHistory[attemptId] = {
                quizId: quizId,
                date: new Date().toISOString(),
                score: results.score,
                totalQuestions: results.totalQuestions,
                answers: results.answers,
                // Store the original question indices for reference
                questionOrder: results.questionOrder
            };

            // Save back to localStorage
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));

            return attemptId;
        }

        // Function to get quiz history for a specific quiz
        function getQuizHistory(quizId) {
            const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};

            // Filter only attempts for this quiz
            return Object.values(quizHistory).filter(attempt => attempt.quizId === quizId);
        }

        // Function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Quiz data - with support for multiple media types
            const quizData = [
                
                        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/It%20was%20broken.%20It%20was%20broken.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=ZYX3xHDyev%2BImaBjpuuUgmga4mjBBdsBlcZ4ByJ0BE03x5p%2F9KopZ9GWl9h6Ljv7BA%2BAeqVKFiqt93UMZgc7qha7ygnvGBe8atror8EUFMM4FfoAh8guS7o4oMYktPCX6CwQ1xeIyqHo8zInJFM8H1J1UKWJD8liNPMxa7UZQiYLTCjq5ZTJbwzQmBUcgFJK0OAQNMn%2F3w9VAQ59lIVZMIvIa9PtrbvZ6gCITKZjGNqe6TQejcTsqPptc8rg68d0bJFLmEWxCdMfIQ8SUbk8ZC8oec47L08NDGpCU1tRh7E4wmPILaGR%2BTEbu1oMF7LvzPv6lsYqaA8VOgKP1g%2F%2BKw%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "It was broken.",
                    "translation": "Estaba dañado.",
                    "correct": true
                },
                {
                    "text": "It looked broken.",
                    "translation": "Parecía dañado.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/It%20was%20not%20broken.%20It%20was%20not%20broken.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=Cw7HLia6p51dIDtEpkgpO8oBx6%2BZe9nZKcWkzfdE97NgTyTLcSJIX8tDhZA2KQ%2BWSmOXeGg4exTXYGI5aOW8zIStihdnhBuOnkWyANiTMPeT21TqmT9pRLtF%2BNn8aAwwMicsh%2BhrznlI9ERIfYdacsApKV4%2F%2BPde8FeO%2B4s6XwRYIaen6CWRfWesRuLkAnDkwdvQyr8IieSSAb619nITAt7Im%2FrD%2BlefqdnZQQBQ31bVhG2Gi9%2B257yCwl%2BtcX%2FKSG%2FMqTaXx69Bkf55hfLyKwVLjOJZnCkz%2FP0OFB0vIIZXYSVb0cVrRpXe15xvw%2FREsrPnibQSFAk0sKRe0vjo6g%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "It was not broken.",
                    "translation": "No estaba dañado.",
                    "correct": true
                },
                {
                    "text": "It wasn’t broken already",
                    "translation": "Ya no estaba dañado.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/It%20will%20be%20done%20soon.%20It%27ll%20be%20done%20soon.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=bJHNq2QEGi%2BpsGNkE0%2BsuAyMSuT3TRIBWfRp682tpt0PRfW%2FpSQz2NC5ow3pHNmWk4ho%2BlUulbSXUixR486YPA2Xgdpbl56VyXvOJjDuCZHWl2UMrpUmrFfELKqnu%2B%2BWZNP6wUyQbWY4MOruI76rX0sRnYxCD1N4vsmObDre6uIPit5oeQZc27%2BP%2F0rHymL6whi2lZCNmGnJ7fbWizLN9OKlukiyUCkU4ARZ6UjC6VRpOCOO%2Bc%2FrwvJM97hBJYmvibfwOlAfxMEc1XihMImFxQz2F4rq0Sar2NJLBSMxBKJAgbtzBApvu6wKZS4M0FZ6Lbez2I6JhHw1fik0cUGX2A%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "It will be done soon.",
                    "translation": "Se hará pronto.",
                    "correct": true
                },
                {
                    "text": "It will be finished soon.",
                    "translation": "Se terminará pronto.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/It%20will%20not%20be%20done%20soon.%20It%20will%20not%20be%20done%20soon.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=iZWQiBoXQ0m%2BLd%2FS3l54KDcEJYLwO%2FqbwazJHae1muzR3oj7B4R%2FPGhXu4lYgg7x3WHvt0PGC1xhdIcruuyw4u0R4VTUCmJS9z3V9bv3jhpaMPv5ds8gVHJd72AJuVzBnjzTuZeXrk%2Bf1%2FyIrP9AvHJ5v4JiQ7YiICNZ%2Bq5zwEaLIF6PG8eOk%2FS50wUnlqFc9SRSMfd23lb%2BolB50BV3%2BXsFkk%2BpcGqhsK%2BRA5V2%2F7Je2Ks23REKCIGxv15%2FDbHQnh37Xi8MRJglSGCr1YYEpYE1vp2Sn%2F2fvHZE9FAFY%2FBXq9DY4ufxf5ZsHKzVcXC2FxJRQRCJLrdhGNFgrtrtBg%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "It will not be done soon.",
                    "translation": "No se hará pronto.",
                    "correct": true
                },
                {
                    "text": "It won’t be finished soon.",
                    "translation": "No se terminará pronto.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/Maria%20is%20not%20attending%20the%20English%20class%20this%20afternoon.%20Maria%20is%20not%20attending%20the%20English%20classes%20afternoon.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=r5SlFiSp4M%2Bl%2BAMtRH1jRo0jEycOVXS0K2bXi6oMbmkozGra4fwT9CYzx8f5buthjTDqiiFvKshy2dc40m%2BtyuIALkUrMsnmoMjK3CWjBOE5Lcn%2Fnla9Xo%2FMmF0%2Fupa9zmRozGFp8f5hHnRKfxxUTO%2B9VcjivHUKugU%2BlZb4YBIulWrhbHru0XlOgOG0iFYorW7xcsZh1r9Tj1ouQpU4u9eUxIDKtLV9jt9A5rVSIQdbInRTT%2F66T0gRG8PTpl1Ew0EJo9UGndp8xZJRlHRPmaaRXH%2BvdvGC4URRxk3SDukEEVIRokypvhEJ8VcrS5J0c1had0iV8r6gn658m6zODA%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "Maria is not attending the English class this afternoon.",
                    "translation": "María no asistirá a la clase de inglés esta tarde.",
                    "correct": true
                },
                {
                    "text": "Maria is attending the English class this afternoon.",
                    "translation": "María asistirá a la clase de inglés esta tarde.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/She%20has%20been%20feeling%20better%2C%20she%27s%20been%20feeling%20better.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=I7lUe13G2Qhj9qdXd%2BekXYotrdcnO4D5tLkdUrS7un4dhok%2BjlG2SEFlc%2BVdNN066FGGIDvc5IVUZpb8t7mshtExw44WndIq2OQEMGu205K1jgjgOPSIHPgRjtkj6C6NGQXCCqlIalI%2FaTJXTfxGqQZQ%2FcNp%2B9%2BWUerkRMqBp1lEmCMC1Pm1cCDsBMba0tMziedmsDleFnPoXQGNdAJij33RSKtBPoHPVMohwprDLGL%2BprqMZ4SSkZAMKJCRgMS4t7N7749J%2BGe2B48tPfV6SXe2pUF8NZKg9uBfl8t5%2Fcuc29yQBo8KqAIA6yK5styHG3ArbxfMLYlBwDV79TFTDg%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "She has been feeling better.",
                    "translation": "Ella ha estado sintiéndose mejor.",
                    "correct": true
                },
                {
                    "text": "She felt tired.",
                    "translation": "Ella se sintió cansada.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/She%20was%20tired%2C%20she%20was%20tired.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=jF6vmypfP3prTl%2BoaBW%2FKsRo74yM32Z%2BSPvQlUh5Pi4ua%2FAKSuCuyv6U%2BvZE7IgIr6z6H1saph4pLYjcejtXY4ZtGXOy8L%2FfXtAITe6hvQl5WCy5tKdHNp3WvUIh%2Bsudlv5ifXX0ansj8lwtBL8pBIrzhXTDHgL%2FeXZAzS%2BKVNBzNndGEXeU2K0g4IJDCumv7Jbn5dsVwWzuwOpVcBUjqg0so3QwI5otJXTpv%2BNqm7tx%2B0P4PVqoF8SzLgCa9VZk63%2Fc2J1TbXgTCt0UGQeszRXhgRPVW%2FTYTK2opSW6gB0BJNFFUE9ACw3zdOLRG%2B0O93fd4B2WOVhv41wK5QD%2BYw%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "She was tired.",
                    "translation": "Ella estaba cansada.",
                    "correct": true
                },
                {
                    "text": "She has been feeling worse.",
                    "translation": "Ella ha estado sintiéndose peor.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/Someone%20has%20been%20in%20charge%20of%20the%20team%20since%20last%20month.%20Someone%20has%20been%20in%20charge%20of%20the%20team%20since%20last%20month.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=SkOzFycCE%2F5bChpIW%2BqyMIROVuUv6iHM5w8clfve0HQXz6MWCkpUSheLr4UBdqh9Jz9C013RIjbKzsbL1mqZfHSt9qMZWpfSM8X9B%2F%2Fk5E5JGi6R9aQDR%2FX3qc0Qcc9UPrqBK7EXG55mtXbqSDlAZUtf5%2B%2BGEifcU0klwrNqlZwGwJ5W332Wdmh6PVDMh71ud4NEoanQtS28oykcBMwvztAxDno18q1wCHj9EvPfqzOfkQytEHRu5U%2Fqr9iTSHhGeY3loUBoNyFarfB5E18x8nk4d5ju5oicNj7DJY8uU0YW0wYt%2Bs994BHriGOzmG%2BKKBGN4U0wWwXJ7L%2FHF1xNAA%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "Someone has been in charge of the team since last month.",
                    "translation": "Alguien ha estado a cargo del equipo desde el mes pasado.",
                    "correct": true
                },
                {
                    "text": "Someone has managed the team since last month.",
                    "translation": "Alguien ha estado dirigiendo el equipo desde el mes pasado.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/The%20car%20is%20ready%20for%20the%20road%20trip.%20The%20car%20is%20ready%20for%20the%20road%20trip.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=dhmp1%2Fi9xJu1YzoDCGgUGbg1%2FqsZGfa1CF0ojmWFXxyuhzR%2BdcXYIVUi9sb%2BPJv2nj11T0KeU4eLGuI0WMSOTDWWpdcYzjSFWVQNtVSl4JkmqoQia%2FjSknykB84ugn%2BFFynjOROVZ0mbiM7fyjpdQB85tvrc8F41die753dyINODWrlFunKNw2yKFrQ3aUDJIa5J8j%2Bkf%2FnVxYqC34stGnXbUaXGX0EvpoppAU7ttV8Tzu66BL%2FEznmPjFATZ5xcYSJ6qD16Ct2GO1fbZ7%2FDjgsFryh8EiXHFeHXrLql6cESLifmCv2p4eTEmZJxsg1yBx26Pjm4hFafrxheRYfc9g%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "The car is ready for the road trip.",
                    "translation": "El carro está listo para el viaje.",
                    "correct": true
                },
                {
                    "text": "The car is packed for the road trip.",
                    "translation": "El carro está empacado para el viaje.",
                    "correct": false
                }
            ]
        },
        {
            "question": "¿Qué dice el audio?",
            "media": [
                {
                    "type": "audio",
                    "src": "https://storage.googleapis.com/chocolearn-f05e5.firebasestorage.app/audio/They%20will%20not%20be%20able%20to%20help%20us.%20They%20will%20not%20be%20able%20to%20help%20us.mp3?GoogleAccessId=firebase-adminsdk-tubvg%40chocolearn-f05e5.iam.gserviceaccount.com&Expires=1898571600&Signature=iREb5Tm%2BV9XpbfnXmlTkP7jrmuUK7ZvATHuVcvmV19NbIbSfnHmToNbZlG3fptOmwaM6bGfhRTyJfiKhkoDT0%2FHZpMhGyBpgUskPeB%2FN2i8nvZQQ%2FOQ6xA%2FJ7wZeCHBYngdZXmKSoz%2Bu994lo381i%2FUGuJrvWskGPec6Iguox1e4DsRy8GjD7rv%2BKd846%2FrOL4wx2CN0XgmfVd6gGi34QiUYbppZQEFw98sIZeuxho60qQ06w2C2Zwi5qU%2Bq1wjV9Czjgo5Ks1YFdjAhNUdibxk79uo7QlUvhLjQzl%2B2lnwNvmAMJYR2hm3Kg3fTzaDklhATc8Eyn1UvQZLaXhnhfg%3D%3D"
                }
            ],
            "options": [
                {
                    "text": "They will not be able to help us.",
                    "translation": "Ellos no podrán ayudarnos.",
                    "correct": true
                },
                {
                    "text": "They won’t be willing to help us.",
                    "translation": "Ellos no estarán dispuestos a ayudarnos.",
                    "correct": false
                }
            ]
        }
            ];

            // DOM Elements
            const quizSection = document.getElementById('quiz-section');
            const resultsSection = document.getElementById('results-section');
            const progressBar = document.getElementById('progress-bar');
            const questionNumberElement = document.getElementById('question-number');
            const questionElement = document.getElementById('question');
            const optionsContainer = document.getElementById('options');
            const mediaContainer = document.getElementById('media-container');
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');
            const scoreElement = document.getElementById('score');
            const resultMessage = document.getElementById('result-message');
            const restartBtn = document.getElementById('restart-btn');
            const confettiContainer = document.getElementById('confetti-container');

            // Quiz state
            let currentQuestionIndex = 0;
            let score = 0;
            let userAnswers = [];
            let originalQuizData; // Store the original quiz data
            let randomizedQuizData; // Store the randomized quiz data
            let questionOrder; // Keep track of the original question indices

            // Initialize quiz
            function initQuiz() {
                currentQuestionIndex = 0;
                score = 0;

                // Store the original quiz data
                originalQuizData = [...quizData];

                // Randomize question order
                questionOrder = Array.from({
                    length: originalQuizData.length
                }, (_, i) => i);
                questionOrder = shuffleArray(questionOrder);

                // Create randomized quiz data
                randomizedQuizData = questionOrder.map(index => {
                    const question = {
                        ...originalQuizData[index]
                    };

                    // Randomize answer options
                    question.options = shuffleArray(question.options);

                    return question;
                });

                // Initialize user answers array with the new randomized length
                userAnswers = Array(randomizedQuizData.length).fill(null);

                showQuestion(currentQuestionIndex);
                updateProgressBar();
                updateNavigationButtons();

                quizSection.style.display = 'block';
                resultsSection.style.display = 'none';

                // Add quiz ID to store results
                quizSection.dataset.quizId = 'multimedia-quiz-' + Date.now();
            }

            // Show current question
            function showQuestion(index) {
                resetState();

                const currentQuestion = randomizedQuizData[index];
                questionElement.textContent = currentQuestion.question;
                questionNumberElement.textContent = `Question ${index + 1}/${randomizedQuizData.length}`;

                // Add media elements
                if (currentQuestion.media && currentQuestion.media.length > 0) {
                    let mediaLoadError = false;

                    currentQuestion.media.forEach(mediaItem => {
                        if (mediaItem.type === "audio") {
                            const audioDiv = document.createElement('div');
                            audioDiv.className = 'audio-player';

                            const audio = document.createElement('audio');
                            audio.controls = true;

                            const source = document.createElement('source');
                            source.src = mediaItem.src;
                            source.type = "audio/mpeg";

                            // Handle audio loading errors
                            audio.onerror = function() {
                                mediaLoadError = true;
                                audioDiv.innerHTML = `<div class="error-message">
                                    Unable to load audio. Please check your internet connection or try again later.
                                </div>`;

                                // Add transcription if available
                                if (currentQuestion.transcription) {
                                    const fallback = document.createElement('div');
                                    fallback.className = 'audio-fallback';
                                    fallback.textContent = `Audio Transcription: "${currentQuestion.transcription}"`;
                                    audioDiv.appendChild(fallback);
                                }
                            };

                            audio.appendChild(source);
                            audioDiv.appendChild(audio);
                            mediaContainer.appendChild(audioDiv);
                        } else if (mediaItem.type === "image") {
                            const imageDiv = document.createElement('div');
                            imageDiv.className = 'image-container';

                            const image = document.createElement('img');
                            image.src = mediaItem.src;
                            image.alt = mediaItem.alt || "Quiz image";
                            image.className = 'quiz-image';

                            // Handle image loading errors
                            image.onerror = function() {
                                mediaLoadError = true;
                                imageDiv.innerHTML = `<div class="error-message">Unable to load image.</div>`;
                            };

                            imageDiv.appendChild(image);
                            mediaContainer.appendChild(imageDiv);
                        } else if (mediaItem.type === "video") {
                            const videoDiv = document.createElement('div');
                            videoDiv.className = 'video-player';

                            const video = document.createElement('video');
                            video.controls = true;
                            video.poster = mediaItem.poster || "";
                            video.preload = "metadata";

                            const source = document.createElement('source');
                            source.src = mediaItem.src;
                            source.type = "video/mp4";

                            // Handle video loading errors
                            video.onerror = function() {
                                mediaLoadError = true;
                                videoDiv.innerHTML = `<div class="error-message">Unable to load video.</div>`;
                            };

                            video.appendChild(source);
                            videoDiv.appendChild(video);
                            mediaContainer.appendChild(videoDiv);
                        } else if (mediaItem.type === "youtube" || mediaItem.type === "iframe") {
                            const videoDiv = document.createElement('div');
                            videoDiv.className = 'video-player';

                            const iframe = document.createElement('iframe');
                            iframe.src = mediaItem.src;
                            iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                            iframe.allowFullscreen = true;

                            // Handle iframe loading errors
                            iframe.onerror = function() {
                                mediaLoadError = true;
                                videoDiv.innerHTML = `<div class="error-message">Unable to load embedded content.</div>`;
                            };

                            videoDiv.appendChild(iframe);
                            mediaContainer.appendChild(videoDiv);
                        }
                    });

                    // Add transcription as fallback if no media
                    if (mediaLoadError && currentQuestion.transcription) {
                        const transcription = document.createElement('div');
                        transcription.className = 'audio-fallback';
                        transcription.textContent = `Transcription: "${currentQuestion.transcription}"`;
                        mediaContainer.appendChild(transcription);
                    }
                } else if (currentQuestion.transcription) {
                    // If question has a transcription but no media
                    const transcription = document.createElement('div');
                    transcription.className = 'audio-fallback';
                    transcription.textContent = `Question: "${currentQuestion.transcription}"`;
                    mediaContainer.appendChild(transcription);
                }

                // Create options with English and Spanish text and restore previous answer if any
                currentQuestion.options.forEach((option, i) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.id = `option${i}`;
                    input.name = 'answer';
                    input.value = i;

                    // Check if user previously selected this option
                    if (userAnswers[currentQuestionIndex] === i) {
                        input.checked = true;
                    }

                    const label = document.createElement('label');
                    label.htmlFor = `option${i}`;

                    // Create spans for English and Spanish text
                    const englishSpan = document.createElement('span');
                    englishSpan.className = 'english-text';
                    englishSpan.textContent = option.text;

                    const spanishSpan = document.createElement('span');
                    spanishSpan.className = 'spanish-text';
                    spanishSpan.textContent = option.translation;

                    label.appendChild(englishSpan);
                    label.appendChild(spanishSpan);

                    optionDiv.appendChild(input);
                    optionDiv.appendChild(label);
                    optionsContainer.appendChild(optionDiv);

                    input.addEventListener('change', () => {
                        userAnswers[currentQuestionIndex] = i;
                    });
                });

                // Update navigation buttons
                updateNavigationButtons();

                // Fade in the new question
                quizSection.classList.add('fade');
                setTimeout(() => {
                    quizSection.classList.remove('fade');
                }, 500);
            }

            // Reset UI state between questions
            function resetState() {
                // Clear options
                while (optionsContainer.firstChild) {
                    optionsContainer.removeChild(optionsContainer.firstChild);
                }

                // Clear media container
                while (mediaContainer.firstChild) {
                    mediaContainer.removeChild(mediaContainer.firstChild);
                }
            }

            // Update navigation button states and text
            function updateNavigationButtons() {
                // Handle previous button visibility
                if (currentQuestionIndex === 0) {
                    prevBtn.style.visibility = 'hidden';
                } else {
                    prevBtn.style.visibility = 'visible';
                }

                // Update next button text for last question
                if (currentQuestionIndex === randomizedQuizData.length - 1) {
                    nextBtn.textContent = 'Finish Quiz';
                } else {
                    nextBtn.textContent = 'Next Question';
                }
            }

            // Handle next question button click
            function handleNextQuestion() {
                // Check if user has selected an answer
                if (userAnswers[currentQuestionIndex] === null) {
                    alert('Please select an answer before proceeding');
                    return;
                }

                // Move to next question or show results
                currentQuestionIndex++;
                updateProgressBar();

                if (currentQuestionIndex < randomizedQuizData.length) {
                    showQuestion(currentQuestionIndex);
                } else {
                    calculateScore();
                    showResults();
                }
            }

            // Handle previous question button click
            function handlePreviousQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    updateProgressBar();
                    showQuestion(currentQuestionIndex);
                }
            }

            // Calculate final score
            function calculateScore() {
                score = 0;
                const detailedAnswers = [];

                for (let i = 0; i < randomizedQuizData.length; i++) {
                    const selectedOptionIndex = userAnswers[i];
                    const isCorrect = selectedOptionIndex !== null &&
                        randomizedQuizData[i].options[selectedOptionIndex].correct;

                    if (isCorrect) {
                        score++;
                    }

                    // Store detailed answer data
                    detailedAnswers.push({
                        questionIndex: questionOrder[i], // Original question index
                        selectedOption: selectedOptionIndex,
                        isCorrect: isCorrect,
                        selectedText: selectedOptionIndex !== null ?
                            randomizedQuizData[i].options[selectedOptionIndex].text : null
                    });
                }

                // Save results to localStorage
                const quizId = quizSection.dataset.quizId;
                saveQuizResults(quizId, {
                    score: score,
                    totalQuestions: randomizedQuizData.length,
                    answers: detailedAnswers,
                    questionOrder: questionOrder
                });

                return score;
            }

            // Show final results
            function showResults() {
                quizSection.style.display = 'none';
                resultsSection.style.display = 'block';

                scoreElement.textContent = `${score}/${randomizedQuizData.length}`;

                const percentage = (score / randomizedQuizData.length) * 100;

                if (percentage === 100) {
                    resultMessage.textContent = 'Perfect score! Amazing job!';
                    createConfetti();
                } else if (percentage >= 75) {
                    resultMessage.textContent = 'Great job! Very impressive!';
                } else if (percentage >= 50) {
                    resultMessage.textContent = 'Good effort!';
                } else {
                    resultMessage.textContent = 'Thanks for taking the quiz!';
                }

                // Clear any existing history section
                const existingHistory = document.querySelector('.history-section');
                if (existingHistory) {
                    existingHistory.remove();
                }

                showQuizHistory();
            }

            // Update progress bar
            function updateProgressBar() {
                const progress = ((currentQuestionIndex) / randomizedQuizData.length) * 100;
                progressBar.style.width = `${progress}%`;
            }

            // Create confetti effect for perfect score
            function createConfetti() {
                const colors = ['#16c4e3', '#fe4980', '#4BB543', '#FFD700', '#9370DB'];
                const confettiCount = 150;

                for (let i = 0; i < confettiCount; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = -10 + 'px';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.opacity = Math.random();
                    confetti.style.transform = 'rotate(' + Math.random() * 360 + 'deg)';

                    confettiContainer.appendChild(confetti);

                    const animation = confetti.animate([{
                            transform: 'translate3d(0,0,0) rotate(0deg)',
                            opacity: 1
                        },
                        {
                            transform: 'translate3d(' + (Math.random() * 100 - 50) + 'px,' +
                                (Math.random() * 700 + 500) + 'px,0) rotate(' + Math.random() * 360 + 'deg)',
                            opacity: 0
                        }
                    ], {
                        duration: Math.random() * 2000 + 3000,
                        easing: 'cubic-bezier(' + Math.random() + ',' + Math.random() + ',' + Math.random() + ',' + Math.random() + ')',
                        fill: 'forwards'
                    });

                    animation.onfinish = function() {
                        confetti.remove();
                    };
                }
            }

            // Show quiz history
            function showQuizHistory() {
                const quizId = quizSection.dataset.quizId;
                const history = getQuizHistory(quizId);

                if (history.length === 0) {
                    return; // No history yet
                }

                // Create a history section in results
                const historySection = document.createElement('div');
                historySection.className = 'history-section';
                historySection.innerHTML = `
                    <h3>Previous Attempts</h3>
                    <div class="history-list"></div>
                `;

                const historyList = historySection.querySelector('.history-list');

                // Display last 5 attempts
                history.slice(-5).forEach((attempt, i) => {
                    const date = new Date(attempt.date);
                    const formattedDate = date.toLocaleString();

                    const attemptElement = document.createElement('div');
                    attemptElement.className = 'history-item';
                    attemptElement.innerHTML = `
                        <p>Attempt ${history.length - i}: ${attempt.score}/${attempt.totalQuestions} 
                        (${Math.round((attempt.score / attempt.totalQuestions) * 100)}%) - ${formattedDate}</p>
                    `;

                    historyList.appendChild(attemptElement);
                });

                // Add history section to results
                resultsSection.appendChild(historySection);
            }

            // Restart quiz
            function restartQuiz() {
                // Clear existing confetti if any
                while (confettiContainer.firstChild) {
                    confettiContainer.removeChild(confettiContainer.firstChild);
                }

                // Clear history section if it exists
                const existingHistory = document.querySelector('.history-section');
                if (existingHistory) {
                    existingHistory.remove();
                }

                initQuiz();
            }

            // Add event listeners
            nextBtn.addEventListener('click', handleNextQuestion);
            prevBtn.addEventListener('click', handlePreviousQuestion);
            restartBtn.addEventListener('click', restartQuiz);

            // Start the quiz
            initQuiz();
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Create the name input modal
            const nameModal = document.createElement('div');
            nameModal.className = 'admin-modal';
            nameModal.id = 'name-modal';
            nameModal.innerHTML = `
        <div class="modal-content">
            <h3 class="modal-title">Enter Your Name</h3>
            <input type="text" id="student-name-input" class="password-input" placeholder="Your name">
            <div class="modal-buttons">
                <button id="save-name-btn" class="admin-button">Save</button>
            </div>
        </div>
    `;
            document.body.appendChild(nameModal);

            // Create the change name button that will appear in the quiz container
            const quizContainer = document.querySelector('.quiz-container');
            const nameDisplay = document.createElement('div');
            nameDisplay.className = 'name-display';
            nameDisplay.innerHTML = `
        <div class="student-name-container">
            <span id="displayed-name"></span>
            <button id="change-name-btn" class="name-change-btn">Change Name</button>
        </div>
    `;

            // Insert the name display right after the h1 element
            const quizTitle = quizContainer.querySelector('h1');
            quizTitle.after(nameDisplay);

            // Add needed styling to the head
            const styleElement = document.createElement('style');
            styleElement.textContent = `
        .student-name-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        #displayed-name {
            font-weight: 500;
            color: #16c4e3;
        }
        
        .name-change-btn {
            background-color: transparent;
            border: 1px solid #16c4e3;
            color: #16c4e3;
            border-radius: 8px;
            padding: 4px 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .name-change-btn:hover {
            background-color: rgba(22, 196, 227, 0.1);
        }
    `;
            document.head.appendChild(styleElement);

            // Get DOM elements
            const nameInput = document.getElementById('student-name-input');
            const saveNameBtn = document.getElementById('save-name-btn');
            const changeNameBtn = document.getElementById('change-name-btn');
            const displayedName = document.getElementById('displayed-name');

            // Function to save the student name
            function saveStudentName(name) {
                if (name && name.trim() !== '') {
                    localStorage.setItem('studentName', name.trim());
                    displayedName.textContent = name.trim();
                    nameModal.style.display = 'none';
                } else {
                    alert('Please enter a valid name');
                }
            }

            // Check if student name already exists
            function checkStudentName() {
                const storedName = localStorage.getItem('studentName');
                if (storedName) {
                    displayedName.textContent = storedName;
                    return true;
                }
                return false;
            }

            // Event listener for save name button
            saveNameBtn.addEventListener('click', function() {
                saveStudentName(nameInput.value);
            });

            // Enter key handler for name input
            nameInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    saveNameBtn.click();
                }
            });

            // Event listener for change name button
            changeNameBtn.addEventListener('click', function() {
                nameInput.value = localStorage.getItem('studentName') || '';
                nameModal.style.display = 'flex';
                nameInput.focus();
            });

            // Show the name modal if no name is set yet
            if (!checkStudentName()) {
                nameModal.style.display = 'flex';
                nameInput.focus();
            }

            // Modify the saveQuizResults function to include student name
            const originalSaveQuizResults = window.saveQuizResults;
            window.saveQuizResults = function(quizId, results) {
                // Get student name from localStorage
                const studentName = localStorage.getItem('studentName') || 'Anonymous';

                // Add student name to results
                results.studentName = studentName;

                // Call the original function
                return originalSaveQuizResults(quizId, results);
            };

            // Modify the admin dashboard results display to show student names
            const originalLoadAdminResults = window.loadAdminResults;
            if (typeof originalLoadAdminResults === 'function') {
                window.loadAdminResults = function() {
                    const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                    const results = Object.values(quizHistory);

                    if (results.length === 0) {
                        document.getElementById('results-list').innerHTML = '<p>No results yet.</p>';
                        return;
                    }

                    const resultsList = document.getElementById('results-list');
                    resultsList.innerHTML = '';

                    // Sort results by date (newest first)
                    results.sort((a, b) => new Date(b.date) - new Date(a.date));

                    results.forEach((result, index) => {
                        const date = new Date(result.date);
                        const formattedDate = date.toLocaleString();
                        const percentage = Math.round((result.score / result.totalQuestions) * 100);
                        const studentName = result.studentName || `Student ${index + 1}`;

                        const resultItem = document.createElement('div');
                        resultItem.className = 'result-item';

                        // Create header with basic info and student name
                        const resultHeader = document.createElement('div');
                        resultHeader.className = 'result-header';
                        resultHeader.innerHTML = `
                    <div>
                        <strong>${studentName}</strong> - ${formattedDate}
                    </div>
                    <div class="result-score">${result.score}/${result.totalQuestions} (${percentage}%)</div>
                `;

                        // The rest of the original function remains the same
                        // Create details toggle button
                        const detailsBtn = document.createElement('button');
                        detailsBtn.className = 'show-details';
                        detailsBtn.textContent = 'Show Details';

                        // Create details section
                        const detailsSection = document.createElement('div');
                        detailsSection.className = 'result-details';

                        // Add details for each question
                        result.answers.forEach((answer, i) => {
                            // This part would remain the same as your original function
                            // ...
                        });

                        // Toggle details visibility
                        detailsBtn.addEventListener('click', function() {
                            if (detailsSection.style.display === 'none' || detailsSection.style.display === '') {
                                detailsSection.style.display = 'block';
                                detailsBtn.textContent = 'Hide Details';
                            } else {
                                detailsSection.style.display = 'none';
                                detailsBtn.textContent = 'Show Details';
                            }
                        });

                        // Add all elements to the result item
                        resultItem.appendChild(resultHeader);
                        resultItem.appendChild(detailsBtn);
                        resultItem.appendChild(detailsSection);
                        resultsList.appendChild(resultItem);
                    });
                };
            }

            // Modify the CSV export function to include student names
            const originalExportResultsAsCSV = window.exportResultsAsCSV;
            if (typeof originalExportResultsAsCSV === 'function') {
                window.exportResultsAsCSV = function() {
                    const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                    const results = Object.values(quizHistory);

                    if (results.length === 0) {
                        alert('No results to export');
                        return;
                    }

                    let csvContent = 'data:text/csv;charset=utf-8,';

                    // Add CSV header row with student name
                    csvContent += 'Student Name,Date,Score,Total Questions,Percentage\n';

                    // Add a row for each result
                    results.forEach((result) => {
                        const date = new Date(result.date).toLocaleString();
                        const percentage = Math.round((result.score / result.totalQuestions) * 100);
                        const studentName = result.studentName || 'Anonymous';

                        const row = [
                            studentName,
                            date,
                            result.score,
                            result.totalQuestions,
                            `${percentage}%`
                        ];

                        csvContent += row.join(',') + '\n';
                    });

                    // Create download link
                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement('a');
                    link.setAttribute('href', encodedUri);
                    link.setAttribute('download', 'quiz_results.csv');
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };
            }
        });
        // Admin functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add admin access button to the body
            const adminAccessBtn = document.createElement('div');
            adminAccessBtn.className = 'admin-access';
            adminAccessBtn.innerHTML = '⚙️';
            document.body.appendChild(adminAccessBtn);

            // Create admin password modal
            const adminModal = document.createElement('div');
            adminModal.className = 'admin-modal';
            adminModal.innerHTML = `
        <div class="modal-content">
            <h3 class="modal-title">Admin Access</h3>
            <input type="password" id="admin-password" class="password-input" placeholder="Enter admin password">
            <div class="modal-buttons">
                <button id="cancel-admin" class="admin-button danger">Cancel</button>
                <button id="access-admin" class="admin-button">Access</button>
            </div>
        </div>
    `;
            document.body.appendChild(adminModal);

            // Admin dashboard elements
            const adminDashboard = document.getElementById('admin-dashboard');
            const adminContent = document.getElementById('admin-content');
            const toggleAdminBtn = document.getElementById('toggle-admin');
            const exportResultsBtn = document.getElementById('export-results');
            const clearResultsBtn = document.getElementById('clear-results');
            const resultsList = document.getElementById('results-list');

            // Admin password modal elements
            const adminPasswordInput = document.getElementById('admin-password');
            const accessAdminBtn = document.getElementById('access-admin');
            const cancelAdminBtn = document.getElementById('cancel-admin');

            // Admin password - change this to your desired password
            const ADMIN_PASSWORD = 'admin123';

            // Click handler for admin access button
            adminAccessBtn.addEventListener('click', function() {
                adminModal.style.display = 'flex';
                adminPasswordInput.focus();
            });

            // Enter key handler for password input
            adminPasswordInput.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    accessAdminBtn.click();
                }
            });

            // Access button handler
            accessAdminBtn.addEventListener('click', function() {
                if (adminPasswordInput.value === ADMIN_PASSWORD) {
                    adminModal.style.display = 'none';
                    adminPasswordInput.value = '';
                    adminDashboard.style.display = 'block';
                    loadAdminResults();
                } else {
                    alert('Incorrect password');
                }
            });

            // Cancel button handler
            cancelAdminBtn.addEventListener('click', function() {
                adminModal.style.display = 'none';
                adminPasswordInput.value = '';
            });

            // Toggle admin content
            toggleAdminBtn.addEventListener('click', function() {
                if (adminContent.style.display === 'none' || adminContent.style.display === '') {
                    adminContent.style.display = 'block';
                    loadAdminResults();
                } else {
                    adminContent.style.display = 'none';
                }
            });

            // Export results as CSV
            exportResultsBtn.addEventListener('click', function() {
                exportResultsAsCSV();
            });

            // Clear all results
            clearResultsBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to delete ALL quiz results? This cannot be undone.')) {
                    localStorage.removeItem('quizHistory');
                    loadAdminResults();
                }
            });

            // Load and display quiz results
            function loadAdminResults() {
                const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                const results = Object.values(quizHistory);

                if (results.length === 0) {
                    resultsList.innerHTML = '<p>No results yet.</p>';
                    return;
                }

                resultsList.innerHTML = '';

                // Sort results by date (newest first)
                results.sort((a, b) => new Date(b.date) - new Date(a.date));

                results.forEach((result, index) => {
                    const date = new Date(result.date);
                    const formattedDate = date.toLocaleString();
                    const percentage = Math.round((result.score / result.totalQuestions) * 100);

                    const resultItem = document.createElement('div');
                    resultItem.className = 'result-item';

                    // Create header with basic info
                    const resultHeader = document.createElement('div');
                    resultHeader.className = 'result-header';
                    resultHeader.innerHTML = `
                <div>
                    <strong>Student ${index + 1}</strong> - ${formattedDate}
                </div>
                <div class="result-score">${result.score}/${result.totalQuestions} (${percentage}%)</div>
            `;

                    // Create details toggle button
                    const detailsBtn = document.createElement('button');
                    detailsBtn.className = 'show-details';
                    detailsBtn.textContent = 'Show Details';

                    // Create details section
                    const detailsSection = document.createElement('div');
                    detailsSection.className = 'result-details';

                    // Add details for each question
                    result.answers.forEach((answer, i) => {
                        const detailRow = document.createElement('div');
                        detailRow.className = 'detail-row';

                        // Get original question data
                        const originalQuestionIndex = result.questionOrder[i];
                        const originalQuestion = quizData[originalQuestionIndex];

                        // Get selected answer text or "No answer"
                        const selectedText = answer.selectedText || "No answer";

                        // Create details content
                        detailRow.innerHTML = `
                    <div>Question ${i + 1}</div>
                    <div>${answer.isCorrect ? '✅ Correct' : '❌ Incorrect'}</div>
                    <div>Answer: ${selectedText}</div>
                `;

                        detailsSection.appendChild(detailRow);
                    });

                    // Toggle details visibility
                    detailsBtn.addEventListener('click', function() {
                        if (detailsSection.style.display === 'none' || detailsSection.style.display === '') {
                            detailsSection.style.display = 'block';
                            detailsBtn.textContent = 'Hide Details';
                        } else {
                            detailsSection.style.display = 'none';
                            detailsBtn.textContent = 'Show Details';
                        }
                    });

                    // Add all elements to the result item
                    resultItem.appendChild(resultHeader);
                    resultItem.appendChild(detailsBtn);
                    resultItem.appendChild(detailsSection);
                    resultsList.appendChild(resultItem);
                });
            }

            // Export quiz results as CSV
            function exportResultsAsCSV() {
                const quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || {};
                const results = Object.values(quizHistory);

                if (results.length === 0) {
                    alert('No results to export');
                    return;
                }

                let csvContent = 'data:text/csv;charset=utf-8,';

                // Add CSV header row
                csvContent += 'Student ID,Date,Score,Total Questions,Percentage\n';

                // Add a row for each result
                results.forEach((result, index) => {
                    const date = new Date(result.date).toLocaleString();
                    const percentage = Math.round((result.score / result.totalQuestions) * 100);

                    const row = [
                        `Student ${index + 1}`,
                        date,
                        result.score,
                        result.totalQuestions,
                        `${percentage}%`
                    ];

                    csvContent += row.join(',') + '\n';
                });

                // Create download link
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement('a');
                link.setAttribute('href', encodedUri);
                link.setAttribute('download', 'quiz_results.csv');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });
    </script>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="admin-dashboard">
        <div class="admin-header">
            <h2>Admin Dashboard</h2>
            <button id="toggle-admin" class="admin-button">Toggle Admin Panel</button>
        </div>
        <div id="admin-content" class="admin-content">
            <div class="admin-controls">
                <h3>Student Results</h3>
                <button id="export-results" class="admin-button">Export All Results (CSV)</button>
                <button id="clear-results" class="admin-button danger">Clear All Results</button>
            </div>
            <div id="results-list" class="results-list">
                <p>No results yet.</p>
            </div>
        </div>
    </div>

</body>

</html>
